---
title: "P8105_hw3"
author: "Jingwei Ren"
date: "10/12/2018"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

##problem1
First, do some data cleaning:

format the data to use appropriate variable names;
focus on the “Overall Health” topic
include only responses from “Excellent” to “Poor”
organize responses as a factor taking levels ordered from “Excellent” to “Poor”

```{r, clean_up}
brfss = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health" & (response == "Excellent" | response == "Very good" |
                                       response == "Good" | response == "Fair" | 
                                       response == "Poor")) %>% 
  mutate(response = factor(response, level = c("Excellent","Very good", "Good", "Fair", "Poor")))
```

Using this dataset, do or answer the following (commenting on the results of each):

In 2002, which states were observed at 7 locations?
```{r, filter}
brfss %>% 
  filter(year == 2002) %>% 
  group_by(locationabbr) %>% 
  summarize(n_location = n_distinct(locationdesc)) %>% 
  filter(n_location == 7)
```
CT,FL and NC were observed at 7 locations.

Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010.

```{r, spaghetti_plot}
location_number = brfss %>% 
  group_by(year, locationabbr) %>% 
  summarize(n_location = n_distinct(locationdesc)) 

ggplot(location_number, aes(x = year, y = n_location, color = locationabbr)) +
  geom_line() +
  labs(
    title = "Number of Locations In Each State",
    x = "year",
    y = "number of locations",
    caption = "Data from the p8105.datasets package"
  ) +
  viridis::scale_color_viridis(
    name = "state", 
    discrete = TRUE
  ) 
  
```

The spaghetti plot shows the number of locations in each state from 2002 to 2010. Most states have a constant number of locations from 2002 to 2010. The number of locations has a obvious change in FL from 2006 to 2010. It first increased dramatically and then deceased sharply and finally increased back.

Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.

```{r, table}
brfss %>% 
  filter(year %in% c(2002, 2006, 2010) & 
           response == "Excellent" &
           locationabbr == "NY") %>% 
  group_by(year) %>% 
  summarize(mean_excellent = mean(data_value, na.rm = TRUE), sd_excellent = sd(data_value)) %>% 
  knitr::kable(digits = 2)

```

The table shows the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State in 2002, 2006, and 2010. The mean of proportion of excellent responses is the highest in 2002 and lowest in 2006. 2002 also has the highest standard deviation of proportion of excellent responses, while 2010 has the lowest.


For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.

```{r, proportion}
average_prop = brfss %>% 
  group_by(year, locationabbr, response) %>% 
  summarize(average = mean(data_value, na.rm = TRUE)) 

average_prop %>%
  ggplot(aes(x = year, y = average,color = locationabbr)) +
  geom_line() +
  labs(
    title = "Distribution of State-Level Response Averages Over Time",
    x = "year",
    y = "average proportion of each response",
    caption = "Data from the p8105.datasets package"
  ) +
  facet_wrap(~ response) +
  viridis::scale_color_viridis(
    name = "state", 
    discrete = TRUE
  ) 
```

The five-panel plot shows the distribution of these state-level averages over time. Very good has the highest proportion and poor has the lowest propotion. In each section, the proportion is fairly constant from 2002 to 2010 for almost all states, except that some states had relatively fluctuations in this period.

## problem 2



